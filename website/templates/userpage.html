<!DOCTYPE html>
<html :class="{ 'theme-dark': dark }" x-data="data()" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Details</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.socket.io/3.1.3/socket.io.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="../static/css/tailwind.output.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" ></script>
	
  </head>
  
  <body>
    
    <div
      class="flex h-screen bg-gray-50 dark:bg-gray-900"
      :class="{ 'overflow-hidden': isSideMenuOpen}"
    >
      <!-- Desktop sidebar -->
      
      <!-- Mobile sidebar -->
      <!-- Backdrop -->
      
    
      <div class="flex flex-col flex-1 w-full">
        <header class="z-10 py-4 bg-white shadow-md dark:bg-gray-800">
          <div
            class="container flex items-center justify-end h-full px-6 mx-auto text-purple-600 dark:text-purple-300"
          >
            <!-- Mobile hamburger -->
            <button
              class="p-1 mr-5 -ml-1 rounded-md md:hidden focus:outline-none focus:shadow-outline-purple"
              @click="toggleSideMenu"
              aria-label="Menu"
            >
              <svg
                class="w-6 h-6"
                aria-hidden="true"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fill-rule="evenodd"
                  d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </button>
            <!-- Search input -->
            
            <ul class="flex items-center  flex-shrink-0 space-x-6">
              <!-- Theme toggler -->
              <li class="flex">
                <button
                  class="rounded-md focus:outline-none focus:shadow-outline-purple"
                  @click="toggleTheme"
                  aria-label="Toggle color mode"
                >
                  <template x-if="!dark">
                    <svg
                      class="w-5 h-5"
                      aria-hidden="true"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path
                        d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                      ></path>
                    </svg>
                  </template>
                  <template x-if="dark">
                    <svg
                      class="w-5 h-5"
                      aria-hidden="true"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                        clip-rule="evenodd"
                      ></path>
                    </svg>
                  </template>
                </button>
              </li>
              <!-- Notifications menu -->
              <li class="relative">
                <button
                  class="relative align-middle rounded-md focus:outline-none focus:shadow-outline-purple"
                  @click="toggleNotificationsMenu"
                  @keydown.escape="closeNotificationsMenu"
                  aria-label="Notifications"
                  aria-haspopup="true"
                >
                  <svg
                    class="w-5 h-5"
                    aria-hidden="true"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"
                    ></path>
                  </svg>
                  <!-- Notification badge -->
                  <span
                    aria-hidden="true"
                    class="absolute top-0 right-0 inline-block w-3 h-3 transform translate-x-1 -translate-y-1 bg-red-600 border-2 border-white rounded-full dark:border-gray-800"
                  ></span>
                </button>
                <template x-if="isNotificationsMenuOpen">
                  <ul
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                    @click.away="closeNotificationsMenu"
                    @keydown.escape="closeNotificationsMenu"
                    class="absolute right-0 w-56 p-2 mt-2 space-y-2 text-gray-600 bg-white border border-gray-100 rounded-md shadow-md dark:text-gray-300 dark:border-gray-700 dark:bg-gray-700"
                    aria-label="submenu"
                  >
                    <li class="flex">
                      <a
                        class="inline-flex items-center justify-between w-full px-2 py-1 text-sm font-semibold transition-colors duration-150 rounded-md hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                        href="#"
                      >
                        <span>Messages</span>
                        <span
                          class="inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-600 bg-red-100 rounded-full dark:text-red-100 dark:bg-red-600"
                        >
                          13
                        </span>
                      </a>
                    </li>
                    <li class="flex">
                      <a
                        class="inline-flex items-center justify-between w-full px-2 py-1 text-sm font-semibold transition-colors duration-150 rounded-md hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                        href="#"
                      >
                        <span>Sales</span>
                        <span
                          class="inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-600 bg-red-100 rounded-full dark:text-red-100 dark:bg-red-600"
                        >
                          2
                        </span>
                      </a>
                    </li>
                    <li class="flex">
                      <a
                        class="inline-flex items-center justify-between w-full px-2 py-1 text-sm font-semibold transition-colors duration-150 rounded-md hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                        href="#"
                      >
                        <span>Alerts</span>
                      </a>
                    </li>
                  </ul>
                </template>
              </li>
              <!-- Profile menu -->
              
            </ul>
            <!-- log out button -->
            <div class="ml-4">
              <a  class="inline-flex items-center w-full px-2 py-1 text-sm font-semibold transition-colors duration-150 rounded-md hover:bg-gray-100 hover:text-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-200"
                        id="logout"   
                      >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" fill="currentColor" class="w-6 h-6">
                <path fill-rule="evenodd" d="M7.5 3.75A1.5 1.5 0 006 5.25v13.5a1.5 1.5 0 001.5 1.5h6a1.5 1.5 0 001.5-1.5V15a.75.75 0 011.5 0v3.75a3 3 0 01-3 3h-6a3 3 0 01-3-3V5.25a3 3 0 013-3h6a3 3 0 013 3V9A.75.75 0 0115 9V5.25a1.5 1.5 0 00-1.5-1.5h-6zm5.03 4.72a.75.75 0 010 1.06l-1.72 1.72h10.94a.75.75 0 010 1.5H10.81l1.72 1.72a.75.75 0 11-1.06 1.06l-3-3a.75.75 0 010-1.06l3-3a.75.75 0 011.06 0z" clip-rule="evenodd" />
              </svg>
              <span>logout</span>
            </a>
              
              
            </div>
          </div>
          
        </header>
        <main class="h-full pb-16 overflow-y-auto">

          <!-- detect button -->
          <div  class="flex justify-center mt-2">
            <button id="run-button" class="btn bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full"  onclick="toggleButton()">Run</button>
            
          </div>
          <div class="container grid px-6 mx-auto mt-2">
            
             
            </h4>
            <div class="w-full overflow-hidden rounded-lg shadow-xs">
              <div class="w-full overflow-x-auto">
                
              </div>
              <img style="width: 200px; height: 200px; border-radius: 90px;" class="rounded"  id="avatar"  alt="Extra large avatar">
              <h1 style="margin-left: 30px; font-size: xx-large; font-weight: 600; font-family:Verdana, Geneva, Tahoma, sans-serif;" id="name">Name</h1>
              <h3 class="text-black dark:text-white" style="margin-top: 20px; font-weight:600; font-size: larger; margin-left: 30px;">User Details</h3>
              
<div class="relative overflow-x-auto mb-6">
  <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
      
      <tbody>
          <tr class="dark:bg-gray-800">
              <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  Gender
              </th>
              <td id="gender" class="px-6 py-4 text-black dark:text-gray-400">
                  
              </td>
              
          </tr>
          <tr class="bg-white dark:bg-gray-800">
              <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  Role
              </th>
              <td id="roles" class="px-6 py-4 text-black dark:text-gray-400">
                 
              </td>
              
          </tr>
          <tr class="bg-white dark:bg-gray-800">
              <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  Phone number
              </th>
              <td  id="number" class="px-6 py-4 text-black dark:text-gray-400">
                 
              </td>
            
          </tr>
          <tr class="bg-white dark:bg-gray-800">
            <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                Email
            </th>
            <td  id="email" class="px-6 py-4 text-black dark:text-gray-400">
               
            </td>
          
        </tr>
      </tbody>
      
  </table>
</div>

            </div>
          </div>
          <!-- chart -->
          <div class="flex justify-center mt-6" style="width: 1000px; margin: 0 auto;"   id="chart"></div>
          <p style= "display: block; text-align: center; margin-top: 30px; font-size: 25px; font-weight: 800; ">Stress Details</p>
          <div class="flex justify-center mt-6 ">
     
            <div style="width: 400px ; text-align: left; font-weight: 400; font-size: 20px;">
              <h3 style="display:inline;">Stress count :</h3>
              <span id="stress-count"></span>
              <br>
              <br>
              <h3 style="display:inline;">Neutral count :</h3>
              <span id="neutral-count"></span>


            </div>
            <div>
              <canvas id="myChart"></canvas>


            </div>
      
          </div>
        </main>
      </div>
      
    </div>
  


    <script src="../static/js/sampe.js"></script>


    <script type="module">
       import { initializeApp  } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
      import { getDatabase,set ,ref,update, child, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js";
	  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
     import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
	  // TODO: Add SDKs for Firebase products that you want to use
	  // https://firebase.google.com/docs/web/setup#available-libraries

	  // Your web app's Firebase configuration
	  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
	  const firebaseConfig = {
      apiKey: "AIzaSyCr_-XEuiGMItFQ_NjXeCY5Q9cuUqUp9lo",
      authDomain: "stress-detection-fffaa.firebaseapp.com",
      projectId: "stress-detection-fffaa",
      storageBucket: "stress-detection-fffaa.appspot.com",
      messagingSenderId: "835851634384",
      appId: "1:835851634384:web:a7c64cfc67defea8db00d5",
      measurementId: "G-8NB1JD9QK0"
    };

	  // Initialize Firebase
	  const app = initializeApp(firebaseConfig);
	  const analytics = getAnalytics(app);
	  const auth = getAuth(app);
      const database = getDatabase(app);
      const usersRef = ref(database, 'users');
    // Call the updateValue function every 5 seconds
      setInterval(updateValue, 5000);

      function updateValue()
      {
        const userId = getAuth().currentUser.uid;
        update1(userId)
      }

      function update1(userId)
      {
        // stresscount = (stresscount/100)*100;
        const userRef = child(usersRef, userId);
  update(userRef, {
    StressCount : stresscount
  });
      }

      

      
     function myFunction()
     {
      stresscount =0;
      neutralcount =0;
       const userId = getAuth().currentUser.uid;
       setUserOffline(userId);
      signOut(auth).then(() => {
       // Sign-out successful.
      
       console.log('Sign-out successful.');
       window.location.href = '/';
       
     }).catch((error) => {
       // An error happened.
       const errorCode = error.code;
          const errorMessage = error.message;
          console.log(errorMessage);
          alert(errorMessage);
     });		  		  
     }
       

     function setUserOffline(userId) {
      
  const userRef = child(usersRef, userId);
  update(userRef, {
    online: false,
    lastOnline: serverTimestamp(),
    StressCount:0
  });
}
     document.getElementById("logout").addEventListener("click", myFunction);

    //stress stats

    var stresscount =0;
    var neutralcount =0;




    //chart
    var x = [];
      var y = [];

      var layout = {
        title: 'Continuous Data',
        xaxis: { title: 'Time' },
        yaxis: { title: 'Value' }
      };

      var chart = Plotly.newPlot('chart', [{
        x: x,
        y: y,
        mode: 'lines',
        line: { color: '#80CAF6' }
      }], layout);

      var socket = io.connect('http://' + document.domain + ':' + location.port);

      socket.on('data', function(msg) {
        var now = new Date();
        x.push(now);
        y.push(msg.value);
        if (x.length > 10) {
          x.shift();
          y.shift();
        }

        console.log(msg.value);
        // console.log(stresscount," ",neutralcount);
        if(msg.value === "stress")
        {
          stresscount++;
          document.getElementById("stress-count").innerHTML = stresscount;
        }
        else{
          neutralcount++;
          document.getElementById("neutral-count").innerHTML = neutralcount;
        }
        Plotly.update('chart', {
          x: [x],
          y: [y]
        });
      });



      //pie chart
     
    // initialize data variables
let value1 = stresscount;
let value2 = neutralcount;

// create a pie chart
const ctx = document.getElementById('myChart').getContext('2d');
const myChart = new Chart(ctx, {
  type: 'pie',
  data: {
    labels: ['Stress', 'Neutral'],
    datasets: [{
      label: 'Continuous Values',
      data: [value1, value2],
      backgroundColor: [
        'rgba(255, 99, 132, 0.5)',
        'rgba(54, 162, 235, 0.5)'
      ],
      borderColor: [
        'rgba(255, 99, 132, 1)',
        'rgba(54, 162, 235, 1)'
      ],
      borderWidth: 1
    }]
  },
  options: {
    responsive: false,
    plugins: {
      legend: {
        position: 'top'
      }
    }
  }
});

// update the chart data every second
setInterval(() => {
  // generate random continuous values
  value1 = stresscount;
  value2 = neutralcount;

  // update the chart data
  myChart.data.datasets[0].data = [value1, value2];
  myChart.update();
}, 1000);

   
  


     
    </script>
    


    
    <script type="module" src="../static/js/scritpt.js"></script>
    <script
      src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"
      defer
    ></script>
    <script src="../static/js/init-alpine.js"></script>
    
  </body>
</html>
